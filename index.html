<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impartial News - January 9, 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Classic newspaper typography */
        body {
            font-family: Georgia, 'Times New Roman', Times, serif;
            background: #fafafa;
            color: #121212;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', Georgia, serif;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* Newspaper-style layout */
        .news-story {
            border-bottom: 1px solid #e5e5e5;
            padding: 1.25rem 0;
            transition: background-color 0.2s, transform 0.1s;
            cursor: pointer;
        }

        .news-story:hover {
            background-color: #f5f5f5;
        }

        .news-story:active {
            transform: scale(0.99);
        }

        .news-story:last-child {
            border-bottom: none;
        }

        .headline {
            font-size: 1.25rem;
            line-height: 1.3;
            margin-bottom: 0.5rem;
            color: #121212;
        }

        .top-headline {
            font-size: 1.5rem;
            line-height: 1.2;
            font-weight: 700;
        }

        .blurb {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .source {
            font-size: 0.75rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .section-header {
            border-top: 3px double #121212;
            border-bottom: 1px solid #121212;
            padding: 0.5rem 0;
            margin: 2rem 0 1rem 0;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        header {
            border-bottom: 3px double #121212;
            padding: 1.5rem 0;
            background: white;
        }

        .masthead {
            font-size: 3rem;
            font-weight: 700;
            text-align: center;
            margin: 0;
            letter-spacing: 2px;
        }

        .tagline {
            text-align: center;
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .date-header {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 0.75rem;
            color: #121212;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Modal styles and animations */
        #story-modal {
            animation: fadeIn 0.2s ease-in-out;
        }

        #story-modal > div {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .masthead { font-size: 2rem; }
            .top-headline { font-size: 1.25rem; }
            .headline { font-size: 1.1rem; }

            #story-modal > div {
                max-height: 95vh;
                margin: 0;
                border-radius: 0.5rem 0.5rem 0 0;
            }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container mx-auto max-w-5xl px-4">
            <h1 class="masthead">IMPARTIAL NEWS</h1>
            <p class="tagline">"All the News That's Fit to Read"</p>
            <p class="date-header">January 9, 2026 | Last Updated: Jan 9, 2026, 2:51 PM</p>
        </div>
    </header>

    <div class="container mx-auto max-w-5xl px-4 mt-4 mb-4">
        <button id="refresh-news-btn"
                class="bg-gray-900 hover:bg-gray-800 text-white font-semibold py-2 px-6 rounded text-sm transition duration-150 ease-in-out"
                style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
            üîÑ Update Edition
        </button>
        <span id="refresh-status" class="ml-4 text-sm text-gray-600"></span>
    </div>

    <main class="container mx-auto max-w-5xl px-4 bg-white" style="padding-top: 1.5rem; padding-bottom: 3rem;">

        <!-- TOP HEADLINES -->
        <section class="mb-8">
            <h2 class="section-header">Top Headlines</h2>
            <div class="grid md:grid-cols-2 gap-x-8">
                                <article class="news-story">
                    <h3 class="headline top-headline">NASA Plans Early Return for Space Station Crew Due to Medical Issue</h3>
                    <p class="blurb">NASA announced it will bring the four-member Crew-11 mission back to Earth early after one astronaut developed an undisclosed medical condition. The rare decision to end a mission early also led to canceling Thursday's planned spacewalk.</p>
                    <p class="source">NPR</p>
                </article>
                <article class="news-story">
                    <h3 class="headline top-headline">Iranian Officials Struggle to Contain Growing Anti-Government Protests</h3>
                    <p class="blurb">At least 62 people have been killed since demonstrations began on December 28, according to human rights groups. Supreme Leader Ayatollah Ali Khamenei stated the government would 'not back down' against protesters.</p>
                    <p class="source">Al Jazeera</p>
                </article>
                <article class="news-story">
                    <h3 class="headline top-headline">House Passes Major FY26 Appropriations Bills with Bipartisan Support</h3>
                    <p class="blurb">The House approved the Commerce, Justice, Science; Energy and Water Development; and Interior and Environment Appropriations Act with a 397-28 vote on Wednesday. The legislation now heads to the Senate for passage.</p>
                    <p class="source">House Appropriations Committee</p>
                </article>
                <article class="news-story">
                    <h3 class="headline top-headline">Stock Markets Reach Record Highs Despite Economic Uncertainty</h3>
                    <p class="blurb">The S&P 500 closed at a record 6,966.28 on Friday, up 0.65%, while the Dow Jones added 237.96 points to reach 49,504.07. Markets showed resilience following the December jobs report showing slower hiring growth.</p>
                    <p class="source">CNBC</p>
                </article>
            </div>
        </section>

        <!-- U.S. NEWS -->
        <section class="mb-8">
            <h2 class="section-header">United States</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">Federal Reserve to Resume Penny Distribution at Commercial Locations</h3>
                    <p class="blurb">Beginning January 14, the Federal Reserve will resume accepting pennies from banks and credit unions at commercial coin distribution locations. The service was previously suspended due to local inventory constraints following the end of penny production.</p>
                    <p class="source">Federal Reserve Financial Services</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">December Jobs Report Shows Slower Hiring with 50,000 New Positions</h3>
                    <p class="blurb">Nonfarm payrolls increased by 50,000 in December, falling short of the 73,000 estimate. The weak numbers suggest the Federal Reserve may not need to cut interest rates in January or March meetings.</p>
                    <p class="source">CNBC</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Administration Directs Purchase of Mortgage Bonds to Lower Housing Costs</h3>
                    <p class="blurb">The President directed representatives to buy mortgage bonds as a strategy to drive down rates for homebuyers. Homebuilder stocks surged on the news, with D.R. Horton jumping nearly 8% and Lennar advancing more than 8%.</p>
                    <p class="source">CNBC</p>
                </article>
            </div>
        </section>

        <!-- WORLD NEWS -->
        <section class="mb-8">
            <h2 class="section-header">World</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">UN Reports Global Economy Expected to Grow 2.7% in 2026</h3>
                    <p class="blurb">The World Economic Situation and Prospects 2026 report, released January 8, forecasts slightly slower growth than 2025's 2.8%. The report warns of persistent trade tensions and fiscal challenges clouding the economic outlook.</p>
                    <p class="source">United Nations</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Bulgaria Officially Adopts Euro as 21st Eurozone Member</h3>
                    <p class="blurb">Bulgaria replaced the lev with the euro on January 1, becoming the newest member of the eurozone. The transition marks a significant milestone in the country's European integration process.</p>
                    <p class="source">Reuters</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Germany Establishes Diplomatic Relations with Pacific Island Niue</h3>
                    <p class="blurb">Germany formally recognized Niue and established diplomatic ties, with the German mission in Wellington coordinating relations. Niue remains in free association with New Zealand while gaining broader international recognition.</p>
                    <p class="source">DPA</p>
                </article>
            </div>
        </section>

        <!-- BUSINESS -->
        <section class="mb-8">
            <h2 class="section-header">Business</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">Stock Indices Hit Multiple Record Highs During First Week of 2026</h3>
                    <p class="blurb">The S&P 500 reached its third intraday record this week at 6,968.42, tracking for a 1.6% weekly gain. Small-cap and blue-chip benchmarks also hit new peaks as equity gains broadened beyond big tech names.</p>
                    <p class="source">Bloomberg</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Nvidia Showcases New Computing Architecture at CES 2026</h3>
                    <p class="blurb">CEO Jensen Huang unveiled the Rubin computing architecture, set to replace Blackwell in the second half of 2026. The company also demonstrated its Alpamayo AI models for autonomous vehicles and showcased physical AI applications.</p>
                    <p class="source">TechCrunch</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Saks Global CEO Replaced as Company Faces Debt Crisis</h3>
                    <p class="blurb">Marc Metrick was replaced by executive chairman Richard Baker effective immediately as the luxury retailer evaluates options including potential bankruptcy. The company assumed significant debt following the Saks-Neiman Marcus merger.</p>
                    <p class="source">Yahoo Finance</p>
                </article>
            </div>
        </section>

        <!-- SPORTS -->
        <section class="mb-8">
            <h2 class="section-header">Sports</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">Montana State Defeats Illinois State 35-34 for FCS Championship</h3>
                    <p class="blurb">The Bobcats won their second national title in an overtime thriller on January 8 in Nashville, Tennessee. This marked Montana State's first championship since 1984, capping an impressive playoff run.</p>
                    <p class="source">NCAA</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Patrick Kane Reaches 500-Goal Milestone in Red Wings Victory</h3>
                    <p class="blurb">Kane scored twice in Detroit's 5-1 win over Vancouver on January 8, becoming the 50th player in NHL history to reach 500 career goals. The veteran forward called it a 'cool feeling' to join the exclusive club.</p>
                    <p class="source">ESPN</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Connor McDavid Extends Points Streak to 17 Games in Oilers Win</h3>
                    <p class="blurb">Edmonton defeated Winnipeg as McDavid continued his impressive scoring run on January 8. The Oilers' captain has been instrumental in the team's recent success while the Jets suffered their 11th consecutive loss.</p>
                    <p class="source">ESPN</p>
                </article>
            </div>
        </section>

        <!-- ENTERTAINMENT -->
        <section class="mb-8">
            <h2 class="section-header">Arts & Entertainment</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">Critics Choice Awards Recognize Excellence in Film and Television</h3>
                    <p class="blurb">The ceremony held January 4 featured nominees including Leonardo DiCaprio, Ariana Grande, and Timoth√©e Chalamet. Films like 'Wicked: For Good' and 'Marty Supreme' led nominations, with series including 'The Pitt' and 'Severance' among TV honorees.</p>
                    <p class="source">E! Online</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Netflix Launches Thriller Series 'His & Hers' Starring Tessa Thompson</h3>
                    <p class="blurb">The limited series premiered January 8, featuring Thompson and Jon Bernthal as locals linked to a shocking murder in a quiet Georgia town. The cast includes Pablo Schreiber, Crystal Fox, and Marin Ireland.</p>
                    <p class="source">Netflix</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Marvel's Wonder Man Series Set to Debut on Disney Plus</h3>
                    <p class="blurb">All eight episodes of the superhero comedy will premiere January 26, starring Yahya Abdul-Mateen II as aspiring actor Simon Williams. Ben Kingsley reprises his MCU role as Trevor Slattery in the meta approach to the Marvel character.</p>
                    <p class="source">Disney+</p>
                </article>
            </div>
        </section>

        <!-- GAMING -->
        <section class="mb-8">
            <h2 class="section-header">Technology & Gaming</h2>
            <div>
                                <article class="news-story">
                    <h3 class="headline">Xbox Announces Developer Direct Showcase for January 22</h3>
                    <p class="blurb">Microsoft confirmed the presentation will feature first looks at 'Fable,' 'Forza Horizon 6,' and other anticipated 2026 titles. The showcase aims to provide release date updates for games with current vague 2026 windows.</p>
                    <p class="source">Xbox Wire</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">GeForce Now Adds 14 New Games for January 2026 Lineup</h3>
                    <p class="blurb">Nvidia's cloud gaming service kicks off the year with RTX 5080-powered performance and 5K 120fps streaming capabilities. Five titles are available to stream this week, with additional games rolling out throughout January.</p>
                    <p class="source">Nvidia</p>
                </article>
                <article class="news-story">
                    <h3 class="headline">Animal Crossing New Horizons Gets Switch 2 Edition Upgrade</h3>
                    <p class="blurb">The enhanced version offers improved resolution, faster loading times, and new features including mouse controls and CameraPlay support. Existing owners can upgrade for $5 when the Switch 2 launches.</p>
                    <p class="source">GameSpot</p>
                </article>
            </div>
        </section>

    </main>

    <!-- INTERACTIVE QUERY SECTION -->
    <section class="container mx-auto max-w-5xl px-4 mt-12 mb-8">
        <div class="bg-white p-6 rounded-lg border-3 border-gray-900" style="border-width: 3px;">
            <h2 class="section-header mb-4">Search for a Specific Story</h2>
            <p class="text-sm text-gray-600 mb-4" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                Ask about any news topic to get an unbiased, factual summary
            </p>

            <div class="flex gap-2 mb-4">
                <input type="text" id="query-input"
                       placeholder="e.g., tell me about the Venezuelan president kidnapping"
                       class="flex-1 px-4 py-2 border border-gray-300 rounded"
                       style="font-family: -apple-system, BlinkMacSystemFont, sans-serif; font-size: 0.95rem;">
                <button id="query-submit-btn"
                        class="bg-gray-900 hover:bg-gray-800 text-white px-6 py-2 rounded font-semibold"
                        style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                    Search
                </button>
            </div>

            <div id="query-status" class="text-sm text-gray-600 mb-4" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;"></div>

            <div id="query-results" class="hidden">
                <!-- Conversation history appears here -->
            </div>
        </div>
    </section>

    <footer class="bg-gray-900 text-gray-400 py-6 mt-8 text-center" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
        <div class="container mx-auto max-w-5xl px-4">
            <p class="text-sm">&copy; 2026 Impartial News Aggregator</p>
            <p class="text-xs mt-2">Curated by artificial intelligence | Updated daily at 6:00 AM PST</p>
        </div>
    </footer>

    <!-- STORY DETAIL MODAL -->
    <div id="story-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" onclick="closeModalOnBackdrop(event)">
        <div class="bg-white rounded-lg max-w-3xl w-full max-h-[90vh] overflow-y-auto relative" onclick="event.stopPropagation()">
            <!-- Close button -->
            <button onclick="closeStoryModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                √ó
            </button>

            <!-- Modal content -->
            <div id="modal-content" class="p-6">
                <!-- Loading state shown first -->
                <div id="modal-loading" class="text-center py-8">
                    <p class="text-lg text-gray-600" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">üîç Researching story details...</p>
                </div>

                <!-- Results shown after loading -->
                <div id="modal-result" class="hidden">
                    <!-- Story details appear here -->
                </div>

                <!-- Follow-up input -->
                <div id="modal-followup" class="hidden mt-6 pt-6 border-t">
                    <p class="text-sm text-gray-600 mb-3" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">Ask a follow-up question:</p>
                    <div class="flex gap-2">
                        <input type="text" id="modal-followup-input"
                               placeholder="e.g., what happened next?"
                               class="flex-1 px-4 py-2 border border-gray-300 rounded"
                               style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                        <button id="modal-followup-btn"
                                class="bg-gray-900 hover:bg-gray-800 text-white px-6 py-2 rounded font-semibold"
                                style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                            Ask
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Refresh news button handler
    document.getElementById('refresh-news-btn').addEventListener('click', async function() {
        const btn = this;
        const status = document.getElementById('refresh-status');

        btn.disabled = true;
        btn.textContent = '‚è≥ Generating...';
        status.textContent = 'This may take 4-5 minutes...';

        try {
            const response = await fetch('https://impartial-news-production.up.railway.app/generate');
            const data = await response.json();

            status.textContent = '‚úÖ ' + data.message + ' - Page will refresh in 60 seconds';

            // Refresh page after 60 seconds to show new content
            setTimeout(() => location.reload(), 60000);
        } catch (error) {
            status.textContent = '‚ùå Error: ' + error.message;
            btn.disabled = false;
            btn.textContent = 'üîÑ Update Edition';
        }
    });

    // Query system state
    let currentConversationId = null;
    let pollInterval = null;

    // Submit query handler
    document.getElementById('query-submit-btn').addEventListener('click', submitQuery);
    document.getElementById('query-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            submitQuery();
        }
    });

    async function submitQuery() {
        const input = document.getElementById('query-input');
        const query = input.value.trim();
        const statusDiv = document.getElementById('query-status');
        const resultsDiv = document.getElementById('query-results');
        const submitBtn = document.getElementById('query-submit-btn');

        if (!query) {
            statusDiv.textContent = '‚ö†Ô∏è Please enter a question';
            statusDiv.className = 'text-sm text-red-600 mb-4';
            return;
        }

        // Disable input during processing
        input.disabled = true;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Searching...';
        statusDiv.textContent = 'üîç Researching your query...';
        statusDiv.className = 'text-sm text-blue-600 mb-4';

        try {
            // Submit query
            const response = await fetch('https://impartial-news-production.up.railway.app/api/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    query: query,
                    conversationId: currentConversationId
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || data.error || 'Request failed');
            }

            // Start polling for results
            startPolling(data.queryId);

        } catch (error) {
            statusDiv.textContent = '‚ùå Error: ' + error.message;
            statusDiv.className = 'text-sm text-red-600 mb-4';
            input.disabled = false;
            submitBtn.disabled = false;
            submitBtn.textContent = 'Search';
        }
    }

    function startPolling(queryId) {
        let attempts = 0;
        const maxAttempts = 30; // 30 attempts √ó 2 seconds = 60 seconds max

        pollInterval = setInterval(async () => {
            attempts++;

            try {
                const response = await fetch(`https://impartial-news-production.up.railway.app/api/query-status/${queryId}`);
                const data = await response.json();

                if (data.status === 'complete') {
                    clearInterval(pollInterval);
                    displayResult(data.result, data.conversationId);
                } else if (data.status === 'error') {
                    clearInterval(pollInterval);
                    const statusDiv = document.getElementById('query-status');
                    statusDiv.textContent = '‚ùå ' + (data.error || 'An error occurred');
                    statusDiv.className = 'text-sm text-red-600 mb-4';
                    resetInputs();
                } else if (attempts >= maxAttempts) {
                    clearInterval(pollInterval);
                    const statusDiv = document.getElementById('query-status');
                    statusDiv.textContent = '‚è±Ô∏è Query timeout - please try again';
                    statusDiv.className = 'text-sm text-red-600 mb-4';
                    resetInputs();
                }
            } catch (error) {
                clearInterval(pollInterval);
                const statusDiv = document.getElementById('query-status');
                statusDiv.textContent = '‚ùå Error checking status: ' + error.message;
                statusDiv.className = 'text-sm text-red-600 mb-4';
                resetInputs();
            }
        }, 2000); // Poll every 2 seconds
    }

    function displayResult(result, conversationId) {
        const statusDiv = document.getElementById('query-status');
        const resultsDiv = document.getElementById('query-results');
        const input = document.getElementById('query-input');

        // Update conversation ID for follow-ups
        currentConversationId = conversationId;

        // Clear status
        statusDiv.textContent = '';

        // Show results section
        resultsDiv.classList.remove('hidden');

        // Create result HTML
        const resultHtml = `
            <div class="news-story" style="padding-top: 1rem; border-top: 2px solid #e5e5e5; margin-top: 1rem;">
                <h3 class="headline" style="font-size: 1.3rem; margin-bottom: 0.75rem;">${escapeHtml(result.headline)}</h3>
                <div class="blurb" style="white-space: pre-wrap; margin-bottom: 0.75rem;">${escapeHtml(result.summary)}</div>
                <div class="text-xs text-gray-600 mb-2" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                    <strong>Sources:</strong> ${result.sources.map(s => escapeHtml(s)).join(', ')}
                </div>
                <div class="text-xs text-gray-500" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                    <strong>Last Updated:</strong> ${escapeHtml(result.last_updated)}
                </div>
                ${result.related_topics && result.related_topics.length > 0 ? `
                <div class="text-xs text-gray-500 mt-2" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                    <strong>Related:</strong> ${result.related_topics.map(t => escapeHtml(t)).join(', ')}
                </div>
                ` : ''}
            </div>
        `;

        resultsDiv.innerHTML = resultHtml + resultsDiv.innerHTML;

        // Reset inputs for follow-up question
        input.value = '';
        input.disabled = false;
        input.placeholder = 'Ask a follow-up question...';

        const submitBtn = document.getElementById('query-submit-btn');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Search';

        // Focus input for follow-up
        input.focus();
    }

    function resetInputs() {
        const input = document.getElementById('query-input');
        const submitBtn = document.getElementById('query-submit-btn');

        input.disabled = false;
        submitBtn.disabled = false;
        submitBtn.textContent = 'Search';
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // =============================================================================
    // MODAL FUNCTIONALITY FOR CLICKABLE STORY CARDS
    // =============================================================================

    // Modal state
    let modalConversationId = null;
    let modalPollInterval = null;

    // Attach click handlers to all story cards
    function attachStoryClickHandlers() {
        document.querySelectorAll('.news-story').forEach(card => {
            card.addEventListener('click', function() {
                const headline = this.querySelector('.headline')?.textContent?.trim();
                if (headline) {
                    openStoryModal(headline);
                }
            });
        });
    }

    // Open modal and fetch story details
    async function openStoryModal(headline) {
        const modal = document.getElementById('story-modal');
        const loadingDiv = document.getElementById('modal-loading');
        const resultDiv = document.getElementById('modal-result');
        const followupDiv = document.getElementById('modal-followup');

        // Show modal with loading state
        modal.classList.remove('hidden');
        loadingDiv.classList.remove('hidden');
        resultDiv.classList.add('hidden');
        resultDiv.innerHTML = '';
        followupDiv.classList.add('hidden');
        modalConversationId = null;

        // Prevent body scroll
        document.body.style.overflow = 'hidden';

        // Query for more details
        const query = `Tell me more about: ${headline}`;

        try {
            const response = await fetch('https://impartial-news-production.up.railway.app/api/query', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || data.error || 'Request failed');
            }

            // Start polling
            startModalPolling(data.queryId);

        } catch (error) {
            loadingDiv.innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
        }
    }

    // Poll for modal results
    function startModalPolling(queryId) {
        let attempts = 0;
        const maxAttempts = 30;

        modalPollInterval = setInterval(async () => {
            attempts++;

            try {
                const response = await fetch(`https://impartial-news-production.up.railway.app/api/query-status/${queryId}`);
                const data = await response.json();

                if (data.status === 'complete') {
                    clearInterval(modalPollInterval);
                    displayModalResult(data.result, data.conversationId);
                } else if (data.status === 'error') {
                    clearInterval(modalPollInterval);
                    document.getElementById('modal-loading').innerHTML =
                        `<p class="text-red-600">‚ùå ${data.error || 'An error occurred'}</p>`;
                } else if (attempts >= maxAttempts) {
                    clearInterval(modalPollInterval);
                    document.getElementById('modal-loading').innerHTML =
                        '<p class="text-red-600">‚è±Ô∏è Timeout - please try again</p>';
                }
            } catch (error) {
                clearInterval(modalPollInterval);
                document.getElementById('modal-loading').innerHTML =
                    `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
            }
        }, 2000);
    }

    // Display result in modal
    function displayModalResult(result, conversationId) {
        const loadingDiv = document.getElementById('modal-loading');
        const resultDiv = document.getElementById('modal-result');
        const followupDiv = document.getElementById('modal-followup');

        modalConversationId = conversationId;

        // Hide loading
        loadingDiv.classList.add('hidden');

        // Build result HTML
        resultDiv.innerHTML = `
            <h2 class="headline top-headline mb-4">${escapeHtml(result.headline)}</h2>
            <div class="blurb mb-6" style="white-space: pre-wrap; font-size: 1.05rem; line-height: 1.7;">
                ${escapeHtml(result.summary)}
            </div>
            <div class="text-sm text-gray-600 mb-3" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                <strong>Sources:</strong> ${result.sources.map(s => escapeHtml(s)).join(', ')}
            </div>
            <div class="text-sm text-gray-500" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                <strong>Last Updated:</strong> ${escapeHtml(result.last_updated)}
            </div>
            ${result.related_topics && result.related_topics.length > 0 ? `
            <div class="text-sm text-gray-500 mt-3" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
                <strong>Related:</strong> ${result.related_topics.map(t => escapeHtml(t)).join(', ')}
            </div>
            ` : ''}
        `;

        // Show result and follow-up input
        resultDiv.classList.remove('hidden');
        followupDiv.classList.remove('hidden');
    }

    // Close modal
    function closeStoryModal() {
        const modal = document.getElementById('story-modal');
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';

        // Clear polling
        if (modalPollInterval) {
            clearInterval(modalPollInterval);
            modalPollInterval = null;
        }

        modalConversationId = null;
    }

    // Close modal when clicking backdrop
    function closeModalOnBackdrop(event) {
        if (event.target.id === 'story-modal') {
            closeStoryModal();
        }
    }

    // Submit follow-up question from modal
    async function submitModalFollowup() {
        const input = document.getElementById('modal-followup-input');
        const query = input.value.trim();

        if (!query || !modalConversationId) return;

        // Show loading in result area
        const resultDiv = document.getElementById('modal-result');
        const followupDiv = document.getElementById('modal-followup');

        followupDiv.classList.add('hidden');
        resultDiv.innerHTML = '<p class="text-center py-8 text-gray-600" style="font-family: -apple-system, BlinkMacSystemFont, sans-serif;">üîç Researching your follow-up question...</p>';

        try {
            const response = await fetch('https://impartial-news-production.up.railway.app/api/query', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query,
                    conversationId: modalConversationId
                })
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.message || data.error);
            }

            // Start polling
            startModalPolling(data.queryId);

        } catch (error) {
            resultDiv.innerHTML = `<p class="text-red-600">‚ùå Error: ${error.message}</p>`;
            followupDiv.classList.remove('hidden');
        }

        // Clear input
        input.value = '';
    }

    // Initialize modal functionality on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Attach click handlers to story cards
        attachStoryClickHandlers();

        // Modal follow-up button
        document.getElementById('modal-followup-btn')?.addEventListener('click', submitModalFollowup);

        // Modal follow-up Enter key
        document.getElementById('modal-followup-input')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitModalFollowup();
            }
        });

        // ESC key to close modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeStoryModal();
            }
        });
    });
    </script>
</body>
</html>
